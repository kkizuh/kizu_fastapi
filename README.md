# üè¶ KizuFinTech Backend (`kizu_fastapi`)

**KizuFinTech** ‚Äî backend‚Äë—Å–µ—Ä–≤–∏—Å –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ª–∏—á–Ω—ã–º–∏ —Ñ–∏–Ω–∞–Ω—Å–∞–º–∏: —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è ‚Üí JWT‚Äë–∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è ‚Üí –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ ‚Üí —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ ‚Üí –±–∞–ª–∞–Ω—Å.

---

## üì¶ –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- üîê –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –∏ –ª–æ–≥–∏–Ω (JWT / OAuth2 *password flow*)
- üè∑Ô∏è CRUD –∫–∞—Ç–µ–≥–æ—Ä–∏–π (–¥–æ—Ö–æ–¥—ã / —Ä–∞—Å—Ö–æ–¥—ã)
- üí∏ CRUD —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π + –º–≥–Ω–æ–≤–µ–Ω–Ω—ã–π –±–∞–ª–∞–Ω—Å (–¥–æ—Ö–æ–¥—ã / —Ä–∞—Å—Ö–æ–¥—ã / –∏—Ç–æ–≥)
- üôã‚Äç‚ôÇÔ∏è `/me` ‚Äî –ø—Ä–æ—Ñ–∏–ª—å, —Å–º–µ–Ω–∞ e‚Äëmail, –∏–º–µ–Ω–∏, –ø–∞—Ä–æ–ª—è
- üìä PostgreSQL + SQLAlchemy ORM
- ü©∫ `/healthz` –¥–ª—è –ø—Ä–æ–≤–µ—Ä–æ–∫ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã
- üåê Swagger UI `/docs` –∏ OpenAPI 3.1 (`/openapi.json`)

---

## üöÄ –°—Ç–µ–∫

| –ö–∞—Ç–µ–≥–æ—Ä–∏—è    | –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏                                 |
| ------------ | ------------------------------------------ |
| Backend      | **FastAPI** + Python 3.11                  |
| ORM / DB     | SQLAlchemy¬†2 ¬∑ PostgreSQL¬†15               |
| Auth         | OAuth2 Password flow + JWT (`python-jose`) |
| –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å | bcrypt (—Ö—ç—à –ø–∞—Ä–æ–ª–µ–π)                       |
| Dev / CI     | Docker ¬∑ docker‚Äëcompose                    |

---

## ‚öôÔ∏è –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
kizu_fastapi/
‚îú‚îÄ‚îÄ app/
‚îÇ   ‚îú‚îÄ‚îÄ main.py           # —Ç–æ—á–∫–∞ –≤—Ö–æ–¥–∞ + include_router(...)
‚îÇ   ‚îú‚îÄ‚îÄ auth.py           # JWT, —Ç–µ–∫—É—â–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
‚îÇ   ‚îú‚îÄ‚îÄ database.py       # –¥–≤–∏–∂–æ–∫ + —Å–µ—Å—Å–∏—è + Base
‚îÇ   ‚îú‚îÄ‚îÄ models.py         # ORM‚Äë–º–æ–¥–µ–ª–∏
‚îÇ   ‚îú‚îÄ‚îÄ schemas.py        # Pydantic‚Äë—Å—Ö–µ–º—ã
‚îÇ   ‚îú‚îÄ‚îÄ users.py          # /me –∏ —Å–º–µ–Ω–∞ –ø–∞—Ä–æ–ª—è
‚îÇ   ‚îú‚îÄ‚îÄ categories.py     # /categories CRUD
‚îÇ   ‚îî‚îÄ‚îÄ transactions.py   # /transactions CRUD + –±–∞–ª–∞–Ω—Å
‚îú‚îÄ‚îÄ docker-compose.yml
‚îú‚îÄ‚îÄ Dockerfile
‚îú‚îÄ‚îÄ requirements.txt
‚îú‚îÄ‚îÄ .env.example          # —à–∞–±–ª–æ–Ω –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö
‚îî‚îÄ‚îÄ README.md             # –≤—ã —á–∏—Ç–∞–µ—Ç–µ –µ–≥–æ
```

---

## üìÇ –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

–°–æ–∑–¥–∞–π—Ç–µ `.env` –∏ –æ—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ:

```env
# –ë–∞–∑–∞
POSTGRES_USER=kizuuser
POSTGRES_PASSWORD=kizupass
DB_HOST=db       
DB_PORT=5432
DB_NAME=kizu

# Auth
SECRET_KEY=supersecret123
ALGORITHM=HS256
TOKEN_EXPIRE_DAYS=3
```

> **–ù–µ –∫–æ–º–º–∏—Ç—å—Ç–µ** `.env` –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π !

---

## üê≥ –ó–∞–ø—É—Å–∫ –≤ Docker

```bash
git clone https://github.com/kkizuh/kizu_fastapi.git
cd kizu_fastapi
cp .env.example .env      # –ø—Ä–∞–≤–∏–º –ø–æ‚Äë—Å–≤–æ–µ–º—É

docker compose up --build
```

- API ‚Äî [http://localhost:8000](http://localhost:8000)
- Swagger ‚Äî [http://localhost:8000/docs](http://localhost:8000/docs)

---

## üìö –û—Å–Ω–æ–≤–Ω—ã–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã

### –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è

| –ú–µ—Ç–æ–¥ | URL         | –û–ø–∏—Å–∞–Ω–∏–µ                 |
| ----- | ----------- | ------------------------ |
| POST  | `/register` | —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è |
| POST  | `/login`    | –ø–æ–ª—É—á–∏—Ç—å JWT + –¥–∞–Ω–Ω—ã–µ    |

### –ü—Ä–æ—Ñ–∏–ª—å (`/me`)

| –ú–µ—Ç–æ–¥ | URL            | –û–ø–∏—Å–∞–Ω–∏–µ              |
| ----- | -------------- | --------------------- |
| GET   | `/me`          | —Ç–µ–∫—É—â–∏–π –ø—Ä–æ—Ñ–∏–ª—å       |
| PATCH | `/me`          | –∏–∑–º–µ–Ω–∏—Ç—å e‚Äëmail / –∏–º—è |
| PATCH | `/me/password` | —Å–º–µ–Ω–∏—Ç—å –ø–∞—Ä–æ–ª—å        |

### –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ üìö

| –ú–µ—Ç–æ–¥  | URL                      | –û–ø–∏—Å–∞–Ω–∏–µ                              |
| ------ | ------------------------ | ------------------------------------- |
| GET    | `/categories?order=name` | —Å–ø–∏—Å–æ–∫ (order = `id`\|`name`\|`type`) |
| POST   | `/categories`            | —Å–æ–∑–¥–∞—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é                     |
| PATCH  | `/categories/{id}`       | —á–∞—Å—Ç–∏—á–Ω–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ                   |
| DELETE | `/categories/{id}`       | —É–¥–∞–ª–∏—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é                     |

### –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ üí∏

| –ú–µ—Ç–æ–¥  | URL                  | –û–ø–∏—Å–∞–Ω–∏–µ                       |
| ------ | -------------------- | ------------------------------ |
| GET    | `/transactions`      | –º–æ–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏                 |
| POST   | `/transactions`      | —Å–æ–∑–¥–∞—Ç—å                        |
| PATCH  | `/transactions/{id}` | —á–∞—Å—Ç–∏—á–Ω–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ            |
| DELETE | `/transactions/{id}` | —É–¥–∞–ª–∏—Ç—å                        |
| GET    | `/balance`           | **–∏—Ç–æ–≥: –¥–æ—Ö–æ–¥—ã / —Ä–∞—Å—Ö–æ–¥—ã / ‚àë** |

### Health‚Äëcheck

| –ú–µ—Ç–æ–¥ | URL        | –û–ø–∏—Å–∞–Ω–∏–µ   |
| ----- | ---------- | ---------- |
| GET   | `/healthz` | –≤—Å–µ–≥–¥–∞ 200 |

> –î–ª—è –≤—Å–µ—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ (–∫—Ä–æ–º–µ `/register`, `/login`, `/healthz`) –Ω—É–∂–µ–Ω –∑–∞–≥–æ–ª–æ–≤–æ–∫\
> `Authorization: Bearer <—Ç–æ–∫–µ–Ω>`.

---

## üßë‚Äçüíª –ü—Ä–∏–º–µ—Ä—ã curl

```bash
# –ª–æ–≥–∏–Ω
curl -X POST http://localhost:8000/login \
     -H "Content-Type: application/json" \
     -d '{"username":"ivan123","password":"secret123"}'

# –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é
TOKEN=$(jq -r .token <<< "$( ‚Ä¶–∫–æ–º–∞–Ω–¥–∞_–≤—ã—à–µ‚Ä¶ )")

# —Å–æ–∑–¥–∞—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é
curl -X POST http://localhost:8000/categories \
     -H "Content-Type: application/json" \
     -H "Authorization: Bearer $TOKEN" \
     -d '{"name":"–ï–¥–∞","type":"expense"}'

# –±–∞–ª–∞–Ω—Å
curl -H "Authorization: Bearer $TOKEN" http://localhost:8000/balance
```

---

## ‚úÖ –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ —Ä–∞–±–æ—Ç—ã

```bash
# –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∏ —É–¥–∞–ª–∏—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã
docker compose down

# —Ç–æ–ª—å–∫–æ –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—å
docker compose stop
```

---

## üìú –õ–∏—Ü–µ–Ω–∑–∏—è

–ü—Ä–æ–µ–∫—Ç —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω—è–µ—Ç—Å—è –ø–æ [Apache License 2.0](LICENSE).
